$(document).ready(function(){function e(){{var e={center:{lat:48.876,lng:2.357},zoom:15,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.TOP_RIGHT}};new google.maps.Map(document.getElementById("map-canvas"),e)}}function n(e,n,o){var a=[];for(var i in e)a.push('<input type="checkbox" name="SMFilter" value="'+e[i]+'">'+e[i]+"<br><i>&nbsp; &nbsp; &nbsp;&#40;cited "+n.SMCount[e[i]]+" times&#41;</i></input>");$("#SubjectiveMarkers").html(a.join("<br />")),$("#SubjectiveMarkers").on("click",function(){t(n,o),$(".pause").hide(),$(".play").show(),s(n,o)}),$("#checkAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!0}),t(n,o),$(".pause").hide(),$(".play").show(),s(n,o)}),$("#uncheckAllBtn").click(function(){$("#SubjectiveMarkers :checkbox").each(function(){this.checked=!1}),t(n,o)}),$("#resetMapBtn").click(function(){map.setView([48.876,2.36],15)})}function t(e,n){S=[],$("input:checkbox[name=SMFilter]:checked").each(function(){S.push($(this).val())}),$("#checkedNum").html(S.length+" categories are checked"),a(e,n)}function o(e){var n=[],t=[],o=[],a=[],i={};for(var r in e.features){var c=e.features[r].properties;void 0===t[c.Page]&&(n.push(c.Page),t[c.Page]=1),void 0===a[c.SM]&&(o.push(c.SM),a[c.SM]=1),void 0===i[c.SM]?i[c.SM]=1:i[c.SM]+=1}return{SMs:o,pages:n.sort(function(e,n){return e-n}),SMCount:i}}function a(e,n,t){map.hasLayer(v)&&map.removeLayer(v),v=L.geoJson(n,{filter:function(e){return t?e.properties.Page==t?!0:!1:-1!==$.inArray(e.properties.SM,S)?!0:!1},pointToLayer:function(e,n){return L.circleMarker(n,{fillColor:i(e.properties.SM),color:i(e.properties.SM),weight:3,fillOpacity:.8,transition:1e3}).on({mouseover:function(){this.openPopup(),this.setStyle({color:"#000000"})},mouseout:function(){this.closePopup(),this.setStyle({color:i(e.properties.SM)})}})}}).addTo(map-canvas),r()}function i(){return"#CC2B0A"}function r(){v.eachLayer(function(e){var n=e.feature.properties,t=c(n.SM),o="<i><b>"+n.SM+"</b></i> <br>"+n.Address+"<br>page "+n.Page;e.setRadius(t),e.bindPopup(o,{offset:new L.Point(0,-t)}),e.options.color=i(n.SM),e.options.fillColor=i(n.SM)})}function c(e){return 12}function l(e,n,t){var o=L.control({position:"bottomright"});o.onAdd=function(){var o=L.DomUtil.create("input","range-slider");return L.DomEvent.addListener(o,"mousedown",function(e){L.DomEvent.stopPropagation(e)}),$(o).attr({type:"range",max:e[e.length-1],min:e[0],step:1,width:4,value:String(e[0])}).on("input change",function(){a(n,t,this.value),$(".temporal-legend").text("On page "+this.value)}),o},o.addTo(map),m(e[0])}function p(e,o){$(".pause").hide(),$(".play").click(function(){$(".pause").show(),$(".play").hide(),map.setView([48.876,2.357],15),clearInterval(y),k=250,u(e,o,k),n(e.SMs,e,o),t()}),$(".pause").click(function(){$(".pause").hide(),$(".play").show(),s(e,o,k)}),$(".step").click(function(){s(),$(".pause").hide(),$(".play").show(),d(e,o)}),$(".back").click(function(){s(),$(".pause").hide(),$(".play").show(),f(e,o)}),$(".back-full").click(function(){s(),$(".pause").hide(),$(".play").show(),h(e,o)}),$(".step-full").click(function(){$(".pause").hide(),$(".play").show(),g(e,o)}),$(".faster").click(function(){k>100?(k-=100,clearInterval(y),u(e,o,k)):k=250}),$(".slower").click(function(){1e3>k?(k+=100,clearInterval(y),u(e,o,k),console.log(k)):k=250})}function u(e,n,t){y=setInterval(function(){d(e,n)},t)}function s(e,n,t){t=0,clearInterval(y)}function f(e,n,t){M>9&&M--,a(e,n,M,t),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function d(e,n,t){238>M&&M++,a(e,n,M,t),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function g(e,n){M=238,a(e,n,M),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function h(e,n){M=9,a(e,n,M),$("input[type=range]").val(M),$(".temporal-legend").text("On Page "+M)}function m(e){var n=L.control({position:"bottomright"});n.onAdd=function(){var e=L.DomUtil.create("output","temporal-legend");return e},n.addTo(map),$(".temporal-legend").text("On page "+e)}var v,k,y,S=[],M=9;google.maps.event.addDomListener(window,"load",e),map=L.map("map").setView([48.876,2.357],15),googleLayer=new L.Google("ROADMAP"),map.addLayer(googleLayer),$.getJSON("data/Locationsv4.geojson").done(function(e){var i=o(e);a(i,e),l(i.pages,i,e),n(i.SMs,i,e),t(i,e),p(i,e)}).fail(function(){alert("There has been a problem loading the data.")})});